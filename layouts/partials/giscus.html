{{ with .Site.Params.giscus }}
  {{ $repo := .repo | default "" }}
  {{ $repoID := .repoID | default "" }}
  {{ $category := .category | default "Announcements" }}
  {{ $categoryID := .categoryID | default "" }}
  {{ if and $repo $repoID $categoryID }}
  {{/* Strip language prefix from path so giscus matches pre-multilingual discussions */}}
  {{ $path := $.RelPermalink }}
  {{ $langPrefix := printf "/%s/" $.Site.Language.Lang }}
  {{ if hasPrefix $path $langPrefix }}
    {{ $path = printf "/%s" (strings.TrimPrefix $langPrefix $path) }}
  {{ end }}
<section class="comments">
  <script
    src="https://giscus.app/client.js"
    data-repo="{{ $repo }}"
    data-repo-id="{{ $repoID }}"
    data-category="{{ $category }}"
    data-category-id="{{ $categoryID }}"
    data-mapping="specific"
    data-term="{{ $path }}"
    data-strict="{{ .strict | default "0" }}"
    data-reactions-enabled="{{ .reactionsEnabled | default "1" }}"
    data-emit-metadata="{{ .emitMetadata | default "0" }}"
    data-input-position="{{ .inputPosition | default "top" }}"
    data-theme="{{ .theme | default "preferred_color_scheme" }}"
    data-lang="{{ cond (eq $.Site.Language.Lang "zh") "zh-CN" $.Site.Language.Lang }}"
    data-loading="{{ .loading | default "lazy" }}"
    crossorigin="anonymous"
    async>
  </script>
</section>
  {{ end }}
{{ end }}
